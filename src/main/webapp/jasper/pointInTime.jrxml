<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" 
	name="pointInTime" pageWidth="792" pageHeight="612" orientation="Landscape" 
	whenNoDataType="NoDataSection" columnWidth="752" leftMargin="20" rightMargin="20" 
	topMargin="20" bottomMargin="20">
	<parameter name="appId" class="java.util.List" isForPrompting="false"/>
	<queryString language="hql">
		<![CDATA[SELECT vulnerability.genericSeverity.name as severity, 
						vulnerability.openTime as importTime, 
						vulnerability.application.name as name
				 FROM Vulnerability as vulnerability
				 WHERE vulnerability.application.id IN ($P{appId}) AND
				 vulnerability.active = true
				 ORDER BY vulnerability.genericSeverity.name, vulnerability.application.name]]>
	</queryString>
	<field name="severity" class="java.lang.String"/>
	<field name="importTime" class="java.util.Calendar"/>
	<field name="name" class="java.lang.String"/>
	<variable name="highCount" class="java.lang.Integer" calculation="Sum">
		<variableExpression><![CDATA["High".equals($F{severity}) ? new Integer(1) : new Integer(0)]]></variableExpression>
	</variable>
	<variable name="mediumCount" class="java.lang.Integer" calculation="Sum">
		<variableExpression><![CDATA["Medium".equals($F{severity}) ? new Integer(1) : new Integer(0)]]></variableExpression>
	</variable>
	<variable name="criticalCount" class="java.lang.Integer" calculation="Sum">
		<variableExpression><![CDATA["Critical".equals($F{severity}) ? new Integer(1) : new Integer(0)]]></variableExpression>
	</variable>
	<variable name="lowCount" class="java.lang.Integer" calculation="Sum">
		<variableExpression><![CDATA["Low".equals($F{severity}) ? new Integer(1) : new Integer(0)]]></variableExpression>
	</variable>
	<variable name="informationalCount" class="java.lang.Integer" calculation="Sum">
		<variableExpression><![CDATA["Info".equals($F{severity}) ? new Integer(1) : new Integer(0)]]></variableExpression>
	</variable>
	<variable name="highAgeSum" class="java.lang.Integer" calculation="Sum">
		<variableExpression><![CDATA["High".equals($F{severity}) ? new Integer((new Long((new Date().getTime() - $F{importTime}.getTimeInMillis()) / (1000 * 3600 * 24))).intValue()) : new Integer(0)]]></variableExpression>
	</variable>
	<variable name="criticalAgeSum" class="java.lang.Integer" calculation="Sum">
		<variableExpression><![CDATA["Critical".equals($F{severity}) ? new Integer((new Long((new Date().getTime() - $F{importTime}.getTimeInMillis()) / (1000 * 3600 * 24))).intValue()) : new Integer(0)]]></variableExpression>
	</variable>
	<variable name="mediumAgeSum" class="java.lang.Integer" calculation="Sum">
		<variableExpression><![CDATA["Medium".equals($F{severity}) ? new Integer((new Long((new Date().getTime() - $F{importTime}.getTimeInMillis()) / (1000 * 3600 * 24))).intValue()) : new Integer(0)]]></variableExpression>
	</variable>
	<variable name="lowAgeSum" class="java.lang.Integer" calculation="Sum">
		<variableExpression><![CDATA["Low".equals($F{severity}) ? new Integer((new Long((new Date().getTime() - $F{importTime}.getTimeInMillis()) / (1000 * 3600 * 24))).intValue()) : new Integer(0)]]></variableExpression>
	</variable>
	<variable name="informationalAgeSum" class="java.lang.Integer" calculation="Sum">
		<variableExpression><![CDATA["Info".equals($F{severity}) ? new Integer((new Long((new Date().getTime() - $F{importTime}.getTimeInMillis()) / (1000 * 3600 * 24))).intValue()) : new Integer(0)]]></variableExpression>
	</variable>
	<background>
		<band/>
	</background>
	<title>
		<band/>
	</title>
	<pageHeader>
		<band height="40">
			<textField>
				<reportElement x="222" y="20" width="309" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA["Application: " + ($P{appId}.size() > 1 ? "All" : $F{name})]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="301" y="0" width="150" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[Point in Time Report]]></text>
			</staticText>
		</band>
	</pageHeader>
	<columnHeader>
		<band/>
	</columnHeader>
	<detail>
		<band/>
	</detail>
	<columnFooter>
		<band/>
	</columnFooter>
	<pageFooter>
		<band/>
	</pageFooter>
	<summary>
		<band height="200">
			<staticText>
				<reportElement x="0" y="0" width="60" height="20"/>
				<box>
					<bottomPen lineWidth="0.75" lineStyle="Solid"/>
					<rightPen lineWidth="0.75" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[Severity]]></text>
			</staticText>
			<staticText>
				<reportElement x="60" y="0" width="45" height="20"/>
				<box>
					<bottomPen lineWidth="0.75" lineStyle="Solid"/>
					<rightPen lineWidth="0.75" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[Count]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="20" width="60" height="20"/>
				<box>
					<rightPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<text><![CDATA[C]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="40" width="60" height="20"/>
				<box>
					<rightPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<text><![CDATA[H]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="60" width="60" height="20"/>
				<box>
					<rightPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<text><![CDATA[M]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="80" width="60" height="20"/>
				<box>
					<bottomPen lineWidth="0.0" lineStyle="Solid"/>
					<rightPen lineWidth="0.75" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<text><![CDATA[L]]></text>
			</staticText>
			<textField>
				<reportElement x="60" y="40" width="45" height="20"/>
				<box>
					<rightPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$V{highCount}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="60" y="60" width="45" height="20"/>
				<box>
					<rightPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$V{mediumCount}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="60" y="80" width="45" height="20"/>
				<box>
					<bottomPen lineWidth="0.0"/>
					<rightPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$V{lowCount}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="60" y="20" width="45" height="20"/>
				<box>
					<rightPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$V{criticalCount}]]></textFieldExpression>
			</textField>
			<pieChart>
				<chart>
					<reportElement x="380" y="0" width="372" height="200"/>
					<chartTitle/>
					<chartSubtitle/>
					<chartLegend/>
				</chart>
				<pieDataset>
					<pieSeries>
						<keyExpression><![CDATA["Critical"]]></keyExpression>
						<valueExpression><![CDATA[$V{criticalCount}]]></valueExpression>
					</pieSeries>
					<pieSeries>
						<keyExpression><![CDATA["High"]]></keyExpression>
						<valueExpression><![CDATA[$V{highCount}]]></valueExpression>
					</pieSeries>
					<pieSeries>
						<keyExpression><![CDATA["Medium"]]></keyExpression>
						<valueExpression><![CDATA[$V{mediumCount}]]></valueExpression>
					</pieSeries>
					<pieSeries>
						<keyExpression><![CDATA["Low"]]></keyExpression>
						<valueExpression><![CDATA[$V{lowCount}]]></valueExpression>
					</pieSeries>
					<pieSeries>
						<keyExpression><![CDATA["Information"]]></keyExpression>
						<valueExpression><![CDATA[$V{informationalCount}]]></valueExpression>
					</pieSeries>
				</pieDataset>
				<piePlot>
					<plot/>
				</piePlot>
			</pieChart>
			<staticText>
				<reportElement x="0" y="100" width="60" height="20"/>
				<box>
					<bottomPen lineWidth="0.75" lineStyle="Solid"/>
					<rightPen lineWidth="0.75" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<text><![CDATA[I]]></text>
			</staticText>
			<textField>
				<reportElement x="60" y="100" width="45" height="20"/>
				<box>
					<bottomPen lineWidth="0.75" lineStyle="Solid"/>
					<rightPen lineWidth="0.75" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$V{informationalCount}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="105" y="0" width="60" height="20"/>
				<box>
					<bottomPen lineWidth="0.75" lineStyle="Solid"/>
					<rightPen lineWidth="0.75" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[Avg Age]]></text>
			</staticText>
			<textField>
				<reportElement x="105" y="40" width="60" height="20"/>
				<box>
					<bottomPen lineWidth="0.0" lineStyle="Solid"/>
					<rightPen lineWidth="0.75" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$V{highCount} != 0 ? $V{highAgeSum} / $V{highCount} : new Integer(0)]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="105" y="20" width="60" height="20"/>
				<box>
					<bottomPen lineWidth="0.0" lineStyle="Solid"/>
					<rightPen lineWidth="0.75" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$V{criticalCount} != 0 ? $V{criticalAgeSum} / $V{criticalCount} : new Integer(0)]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="105" y="60" width="60" height="20"/>
				<box>
					<bottomPen lineWidth="0.0" lineStyle="Solid"/>
					<rightPen lineWidth="0.75" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$V{mediumCount} != 0 ? $V{mediumAgeSum} / $V{mediumCount} : new Integer(0)]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="105" y="80" width="60" height="20"/>
				<box>
					<bottomPen lineWidth="0.0" lineStyle="Solid"/>
					<rightPen lineWidth="0.75" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$V{lowCount} != 0 ? $V{lowAgeSum} / $V{lowCount} : new Integer(0)]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="105" y="100" width="60" height="20"/>
				<box>
					<bottomPen lineWidth="0.75" lineStyle="Solid"/>
					<rightPen lineWidth="0.75" lineStyle="Solid"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<textFieldExpression class="java.lang.Integer"><![CDATA[$V{informationalCount} != 0 ? $V{informationalAgeSum} / $V{informationalCount} : new Integer(0)]]></textFieldExpression>
			</textField>
		</band>
	</summary>
	<noData>
		<band height="20">
			<staticText>
				<reportElement x="222" y="0" width="309" height="20"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="Arial" size="12" isBold="true" pdfFontName="Helvetica-Bold"/>
				</textElement>
				<text><![CDATA[No Data Found For Point in Time Report]]></text>
			</staticText>
		</band>
	</noData>
</jasperReport>
